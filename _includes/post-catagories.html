{% comment %}
  post-categories.html (Modified)
  This file iterates through all categories and lists posts within them.
  Optional Parameter: include.id
  If 'include.id' is passed, only posts that also have 'include.id' as a category
  will be displayed.
{% endcomment %}

{% for category in site.categories %}
  {% assign category_name = category | first %}
  <section class="section  typeset">
    <h2 id="{{ category_name | slugify }}">{{ category_name }}</h2>
    <ul class="list  list--posts">
      {% for page in site.categories[category_name] %}
        {% assign display_post = false %}

        {% if include.id %}
          {# If 'id' parameter is provided, check if the post contains that ID as a category #}
          {% if page.categories contains include.id %}
            {% assign display_post = true %}
          {% endif %}
        {% else %}
          {# If 'id' parameter is NOT provided, display all posts within the current category #}
          {% assign display_post = true %}
        {% endif %}

        {% if display_post %}
          {% assign has_categories = true %}
          <li class="item  item--post">
            <article class="article  article--post  typeset">
              <h3><a href="{{ site.baseurl }}{{ page.url }}">{{ page.title }}</a></h3>
              {% include post-meta.html %}
              {{ page.excerpt | truncatewords: 60 | markdownify }}
            </article>
          </li>
        {% endif %}
      {% endfor %}
    </ul>
    {% unless forloop.last %}<hr/>{% endunless %}
  </section>
{% endfor %}

{% if has_categories != true %}
  <section class="section  typeset">
    <p>There are no categorised posts</p>
  </section>
{% endif %}
